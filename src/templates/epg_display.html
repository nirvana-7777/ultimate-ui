{% extends "base.html" %}

{% block content %}
<div class="epg-container">
    <!-- Sticky Date Navigation -->
    <div class="date-navigation">
        <h2>EPG Programmübersicht</h2>
        <div class="date-controls">
            <button class="btn-date" id="date-prev-btn" aria-label="Vorheriger Tag">
                <span>←</span> Vorheriger Tag
            </button>
            <span class="date-display" id="date-display">{{ current_date|default('Heute') }}</span>
            <button class="btn-date" id="date-next-btn" aria-label="Nächster Tag">
                Nächster Tag <span>→</span>
            </button>
            <button class="btn-date active" id="date-today-btn" aria-label="Heute">
                Heute
            </button>
        </div>
    </div>

    <!-- Current Events Grid -->
    <div class="current-events-grid" id="current-events-grid">
        <!-- Will be populated by JavaScript -->
    </div>

    <!-- Daily Programs -->
    <div class="daily-programs">
        <div class="daily-programs-header">
            <h3>Tagesprogramm</h3>
            <small class="text-muted">Klicken Sie auf einen Sender, um das Programm anzuzeigen</small>
        </div>
        <!-- Will be populated by JavaScript -->
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <span>Lädt EPG-Daten...</span>
    </div>
</div>

<!-- Program Details Modal -->
<div class="program-details-modal" id="program-details-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Programmdetails</h3>
            <button class="modal-close" id="modal-close-btn" aria-label="Schließen">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-body-content" id="modal-program-content">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Floating Video Player -->
<div class="floating-player" id="floating-player">
    <div class="player-header">
        <h4 id="player-title"></h4>
        <div class="player-controls">
            <button class="player-minimize" id="player-minimize" aria-label="Minimieren">−</button>
            <button class="player-close" id="player-close" aria-label="Schließen">×</button>
        </div>
    </div>
    <div class="player-content">
        <video id="floating-video" controls playsinline></video>
    </div>
    <div class="player-info">
        <div class="player-info-title" id="player-title-text"></div>
        <div class="player-info-subtitle" id="player-subtitle"></div>
    </div>
</div>

<!-- Template configuration -->
<script>
    // Pass configuration to JavaScript
    window.EPG_CONFIG = {
        timezone: "{{ config.ui.timezone if config and config.ui else 'Europe/Berlin' }}",
        dateFormat: "de-DE",
        refreshInterval: {{ config.ui.refresh_interval if config and config.ui else 300 }},
        currentDate: "{{ current_date|default('') }}"
    };

    // Helper function for modal close
    document.getElementById('modal-close-btn')?.addEventListener('click', () => {
        document.getElementById('program-details-modal')?.classList.remove('active');
    });
</script>
{% endblock %}